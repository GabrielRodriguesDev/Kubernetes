apiVersion: apps/v1                       
kind: Deployment                          
metadata:                                 
  namespace: gabriel                      
  name: goserver               
  labels:                                 
    app: goserver              
spec:                                     
  replicas: 2                             
  selector:                               
    matchLabels:                          
      app: goserver                  
  template:                               
    metadata:                 
      labels:                 
        app: goserver  
    spec:                     
      containers:             
        - name: goserver      
          image: "gabrielrodriguesdev/hello-go:0.0.7"
          startupProbe:                                                     #Assume o papel initialDelaySeconds pois ele roda antes do readiness e liveness. -> Após o startupProbes os restante entra em ação 
            httpGet:                                                        #Definindo protocolo de requisição HTTP
              path: /helthz                                                 #Definindo path do endpoint
              port: 8000                                                    #Definindo a porta do container
            periodSeconds: 3                                                #Definindo o tempo em segundos, no qual ele irá refazer esse teste
            failureThreshold: 30                                            #Definindo qual será a quantidade de erros minimas (aceitavel). -> Fazendo uma analise ele vai tentar fazer o teste de inicialização 30 vezes a cada 1 segundo, portanto o container tem 30 segundos para iniciar.
          readinessProbe:                                                   
            httpGet:                                                        
              path: /helthz                                                 
              port: 8000                                                    
            periodSeconds: 1                                                
            failureThreshold: 1                                             
          livenessProbe:                                                    
            httpGet:                                                        
              path: /helthz                                                 
              port: 8000                                                    
            periodSeconds: 5                                                
            timeoutSeconds: 1
            failureThreshold: 1                                             
            successThreshold: 1
          resources:
            limits:
              memory: 512Mi
              cpu: "1"
            requests:
              memory: 256Mi
              cpu: "0.2"
          envFrom:                                                  
            - secretRef:                                            
                name: goserver-secret                               
---
apiVersion: v1
kind: Service
metadata:
  namespace: gabriel
  name: goserver-service
spec:
  selector: 
    app: goserver
  type: ClusterIP
  ports:
    - name: goserver-service
      port: 80
      targetPort: 8000
      protocol: TCP